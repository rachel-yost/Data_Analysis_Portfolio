<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rachel Yost">
<meta name="dcterms.date" content="2024-10-05">

<title>Exploratory Analysis on the Effects of Weather Conditions and Aging on Marthon Performance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Project_1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Project_1_files/libs/quarto-html/quarto.js"></script>
<script src="Project_1_files/libs/quarto-html/popper.min.js"></script>
<script src="Project_1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Project_1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Project_1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Project_1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Project_1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Project_1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Project_1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Project_1_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Project_1_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploratory Analysis on the Effects of Weather Conditions and Aging on Marthon Performance</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rachel Yost </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>Previous studies have found that environmental temperature decreases marathon performance. Additionally, older adults experience difficulties with thermoregulation. Using data provided by Dr.&nbsp;Brett Romano and Dr.&nbsp;Matthew Ely from the Department of Health Sciences at Providence College, we performed an exploratory data analysis aiming to examine the effects of increasing age on marathon performance in men and women; explore the impact of environmental conditions on marathon performance, and whether the impact differs across age and gender; and identify the weather parameters that have the largest impact on marathon performance. We hypothesized that the weather would have a stronger negative impact on older runners, and that effects would be similar between men and women. Furthermore,we suspected that relative humidity, temperature, and solar radiation would have the strongest impact on runners. Based on the results of my exploratory data analysis, weather has a stronger impact on runners as age increases, but effects do not vary significantly by gender. Furthermore, based on a linear regression and correlations between race results and weather conditions, we found that relative humidity, air quality, and solar radiation have the largest impact on marathon performance. Future research is needed to statistically analyze the impact of weather, age, and gender on marathon performance.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In recent years, we’ve seen an increase in marathon participants (Reusser et al., 2021), but also an increase in heatwaves (NOAA, 2024), which could impact athletic performance (Ely et al., 2007). Also, thermoregulation ability is known to decrease with age, affecting sweat gland function, skin blood flow, cardiac output, and blood flow redistribution (Kenny and Munce, 2023). This could potentially cause problems for older runners who are racing in unfavorable weather conditions. This has been shown in the New York marathon, where older runners were more affected by high temperatures and humidity (Knechtle et al.&nbsp;2021). Differences in marathon performance are also seen across genders. For example, men are more likely to slow down over the course of the marathon (Deanor et al. 2015).</p>
<p>Using data provided by Dr.&nbsp;Brett Romano and Dr.&nbsp;Matthew Ely from the Department of Health Sciences at Providence College, we performed an exploratory data analysis with the following three aims: <strong>1. Examine effects of increasing age on marathon performance in men and women. 2. Explore the impact of environmental conditions on marathon performance, and whether the impact differs across age and gender. 3. Identify the weather parameters that have the largest impact on marathon performance.</strong> We hypothesized that aging would decrease marathon performance, and that weather would have a stronger negative effect on marathon performance as age increased, but effects would be similar between men and women. Additionally, we hypothesized that humidity, solar radiation, and temperature would all have a strong impact on marathon performance, and that wind and air quality would have a lesser impact.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="data-description" class="level2">
<h2 class="anchored" data-anchor-id="data-description">Data Description</h2>
<p>The provided data from the Department of Health Sciences at Providence College contained results from the Boston, Chicago, New York, Twin Cities, and Grandma’s marathons across 15-20 years. Each row of the data contained the top single-age performances from males and females between the ages of 14 and 85 for each of the 5 marathons. The following weather parameters were also included: dry bulb temperature, wet bulb temperature (which factors in humidity), percent relative humidity, black globe temperature (factors in solar radiation), wind speed in km/hr, dew point, and WBGT (calculated as (.07 * Wet-bulb temperature) + (.02 * black globe temperature) + (0.1 * dry bulb temperature)). Additionally, a variable describing the flag color used to warn participants of weather conditions was used. The flag color was determined based on the following conditions: White = WGBT &lt; 10C, Green = WGBT between 10-18C, Yellow = WGBT between 18-23C, Red = WBGT between 23-28C, and Black = WBGT &gt; 28C.</p>
<p>Instead of the finishing time for each participant, the data provided the percent off the current course record for each gender. This value was used for most analyses to allow for more accurate comparisons across races, which may have varying difficulty.</p>
<p>Additionally, we included air quality index measurements from the RAQSAPI package (Mccrowey et al.&nbsp;2023), which retrieves air quality data from the United States Environmental Protection Agency. From this package, we selected to use air quality index (aqi) measurements from core based statistical area (CBSA) codes 14460 (Boston-Cambridge-Newton), 35620 (New York-Newark-Jersey City), 33460 (<strong><br>
</strong>Minneapolis-St.&nbsp;Paul-Bloomington), 16980 (Chicago-Naperville-Elgin), and 20260 (Duluth) , from the dates of each of the marathons over the time period from 1993-2016. Each of these codes is a marathon location. We chose to use the values from the 24 hour sample duration, which is recorded in micrograms/cubic meter. The data contained some duplicates, so we removed duplicate values. Since each CBSA code contained multiple sites where aqi was measured, we averaged the data between all sites for each CBSA code for each date.</p>
<section id="missing-data-and-data-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="missing-data-and-data-preprocessing">Missing data and data preprocessing</h4>
<p><br>
My first step in preprocessing the data was to rename the columns so that they were easier to handle within the code. We removed spaces and symbols from variable names. Next, we checked the data types of each variable to make sure they made sense for my analyses. We changed “Race”, “Year”, “Sex”, and “Flag” from character/numeric to factors. We also changed the values for Race, so that each observation was the name of the marathon rather than a numerical code. We did the same for Sex, and re-coded 0 as “Female” and 1 as “Male”.</p>
<p>I also calculated the actual time of each participant in minutes, using the course records for each race for each year by gender. We converted the course record from hours into minutes, and then performed the following calculation: Time in minutes = ((Percent off course record)/100) + 1) * Course Record in minutes).</p>
<p>Based on data found from the analyses shown in Figure 1., we also created a variable that groups participants by age. Runners younger than 20 were in “Young”, ages 20-49 were in “Middle”, 50-64 were in “Older”, and runners 65 or older were in “Senior”. These groups were made based on trends in performance as age increased.</p>
<p>Next,wechecked for missing data and found that weather variables, not including aqi, were missing for the Twin Cities, Chicago, and New York marathons in 2011, and the Grandma’s marathon in 2012. AQI data was missing for 32 of the races.</p>
<p>I checked the distribution of each variable, and we noticed that 32% of the values for relative humidity were less than 1, but then the other 68% of the values were all greater than 33. This seemed suspicious, and after comparing the relative humidities that were less than 1 with several historical weather reports from those dates, we decided that the data was just recorded in a different format, and that any values less than 1 could be multiplied by 100 to get the percent relative humidity.</p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>The data included 11,564 runners, of which 47% were female and 53% were male. Most races had a green flag (42%), while few had a red flag (5.3%). None of the data included the most severe flag option, black. The age groups were binned so that around 5% of participants were in “Young”, 50% of participants were in “Middle”, 25% in “Older”, and 20% in “Senior”. These statistics and other characteristics can be seen in Table 1. For continuous variables, medians and the first and third quartile were calculated. For categorical variables, counts and percentages are shown.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Race Characteristics</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Boston<br>
N = 18</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Chicago<br>
N = 21</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Grandma's<br>
N = 17</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">New York<br>
N = 23</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Twin Cities<br>
N = 17</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Flag</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">White</td>
<td style="text-align: center;">9 (50%)</td>
<td style="text-align: center;">6 (30%)</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">11 (50%)</td>
<td style="text-align: center;">5 (31%)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Green</td>
<td style="text-align: center;">7 (39%)</td>
<td style="text-align: center;">12 (60%)</td>
<td style="text-align: center;">6 (38%)</td>
<td style="text-align: center;">7 (32%)</td>
<td style="text-align: center;">7 (44%)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Yellow</td>
<td style="text-align: center;">1 (5.6%)</td>
<td style="text-align: center;">1 (5.0%)</td>
<td style="text-align: center;">8 (50%)</td>
<td style="text-align: center;">4 (18%)</td>
<td style="text-align: center;">3 (19%)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Red</td>
<td style="text-align: center;">1 (5.6%)</td>
<td style="text-align: center;">1 (5.0%)</td>
<td style="text-align: center;">2 (13%)</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">1 (6.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Black</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">0 (0%)</td>
<td style="text-align: center;">0 (0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dry Bulb</td>
<td style="text-align: center;">9.0 (8.3, 13.8)</td>
<td style="text-align: center;">13.6 (7.4, 15.3)</td>
<td style="text-align: center;">18.7 (16.3, 22.0)</td>
<td style="text-align: center;">11.5 (7.4, 15.1)</td>
<td style="text-align: center;">11.6 (9.0, 16.5)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wet Bulb</td>
<td style="text-align: center;">7.2 (5.4, 8.2)</td>
<td style="text-align: center;">9.3 (2.7, 12.5)</td>
<td style="text-align: center;">14.3 (13.7, 16.2)</td>
<td style="text-align: center;">7.2 (2.9, 11.5)</td>
<td style="text-align: center;">8.7 (6.6, 12.6)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">% Relative Humidity</td>
<td style="text-align: center;">37 (1, 58)</td>
<td style="text-align: center;">60 (53, 68)</td>
<td style="text-align: center;">58 (1, 78)</td>
<td style="text-align: center;">1 (0, 55)</td>
<td style="text-align: center;">53 (1, 70)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Black Globe</td>
<td style="text-align: center;">23 (19, 28)</td>
<td style="text-align: center;">26 (21, 29)</td>
<td style="text-align: center;">34 (28, 38)</td>
<td style="text-align: center;">20 (18, 25)</td>
<td style="text-align: center;">26 (20, 30)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Solar Radiation</td>
<td style="text-align: center;">721 (574, 800)</td>
<td style="text-align: center;">470 (437, 518)</td>
<td style="text-align: center;">736 (571, 838)</td>
<td style="text-align: center;">393 (309, 546)</td>
<td style="text-align: center;">488 (355, 541)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dew Point</td>
<td style="text-align: center;">3 (0, 6)</td>
<td style="text-align: center;">6 (-2, 10)</td>
<td style="text-align: center;">12 (11, 14)</td>
<td style="text-align: center;">2 (-4, 9)</td>
<td style="text-align: center;">6 (3, 10)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wind</td>
<td style="text-align: center;">11.8 (8.3, 16.0)</td>
<td style="text-align: center;">8.0 (5.3, 10.2)</td>
<td style="text-align: center;">9.3 (7.7, 11.2)</td>
<td style="text-align: center;">11.2 (9.0, 14.0)</td>
<td style="text-align: center;">9.3 (6.5, 10.0)</td>
</tr>
<tr class="even">
<td style="text-align: left;">WBGT</td>
<td style="text-align: center;">9.9 (8.7, 12.7)</td>
<td style="text-align: center;">13.1 (7.2, 16.1)</td>
<td style="text-align: center;">18.1 (16.0, 21.0)</td>
<td style="text-align: center;">10.2 (6.7, 14.1)</td>
<td style="text-align: center;">12.6 (9.0, 16.3)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AQI</td>
<td style="text-align: center;">44 (30, 55)</td>
<td style="text-align: center;">52 (42, 69)</td>
<td style="text-align: center;">22 (14, 27)</td>
<td style="text-align: center;">47 (28, 54)</td>
<td style="text-align: center;">31 (19, 43)</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>1</sup> n (%); Median (Q1, Q3)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Participant Characteristics</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Characteristic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Boston<br>
N = 2,085</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Chicago<br>
N = 2,549</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Grandma's<br>
N = 1,994</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">New York<br>
N = 2,925</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Twin Cities<br>
N = 1,990</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sex</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Female</td>
<td style="text-align: center;">981 (47%)</td>
<td style="text-align: center;">1,209 (47%)</td>
<td style="text-align: center;">933 (47%)</td>
<td style="text-align: center;">1,400 (48%)</td>
<td style="text-align: center;">922 (46%)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Male</td>
<td style="text-align: center;">1,104 (53%)</td>
<td style="text-align: center;">1,340 (53%)</td>
<td style="text-align: center;">1,061 (53%)</td>
<td style="text-align: center;">1,525 (52%)</td>
<td style="text-align: center;">1,068 (54%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: center;">47 (32, 61)</td>
<td style="text-align: center;">46 (30, 61)</td>
<td style="text-align: center;">44 (29, 58)</td>
<td style="text-align: center;">49 (33, 65)</td>
<td style="text-align: center;">44 (30, 59)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">% Course Record</td>
<td style="text-align: center;">32 (18, 56)</td>
<td style="text-align: center;">38 (20, 67)</td>
<td style="text-align: center;">38 (20, 62)</td>
<td style="text-align: center;">37 (19, 69)</td>
<td style="text-align: center;">36 (19, 63)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time</td>
<td style="text-align: center;">176 (155, 208)</td>
<td style="text-align: center;">182 (157, 222)</td>
<td style="text-align: center;">190 (165, 227)</td>
<td style="text-align: center;">186 (158, 230)</td>
<td style="text-align: center;">188 (164, 226)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age Binned</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Young</td>
<td style="text-align: center;">67 (3.2%)</td>
<td style="text-align: center;">179 (7.0%)</td>
<td style="text-align: center;">176 (8.8%)</td>
<td style="text-align: center;">92 (3.1%)</td>
<td style="text-align: center;">149 (7.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Middle</td>
<td style="text-align: center;">1,078 (52%)</td>
<td style="text-align: center;">1,257 (49%)</td>
<td style="text-align: center;">1,016 (51%)</td>
<td style="text-align: center;">1,378 (47%)</td>
<td style="text-align: center;">1,017 (51%)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Older</td>
<td style="text-align: center;">532 (26%)</td>
<td style="text-align: center;">629 (25%)</td>
<td style="text-align: center;">505 (25%)</td>
<td style="text-align: center;">687 (23%)</td>
<td style="text-align: center;">506 (25%)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Senior</td>
<td style="text-align: center;">408 (20%)</td>
<td style="text-align: center;">484 (19%)</td>
<td style="text-align: center;">297 (15%)</td>
<td style="text-align: center;">768 (26%)</td>
<td style="text-align: center;">318 (16%)</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>1</sup> n (%); Median (Q1, Q3)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<div style="page-break-after: always;"></div>
<p>To start, we plotted percent off of course record by age for each of the five marathons. As shown in Figure 1, the youngest runners gradually improved in performance until a peak around age 25. This was consistent for both males and females. Males and females both decreased in performance steadily until their late 50s-early 60s, and then performance began decreasing quickly. Running performance in females generally declined more with age, compared to males. However, performance became similar after about age 75. This suggests a possible interaction between age and gender on marathon performance, with women beginning to quickly decrease in pace at an earlier age than men. These results were consistent across races.<br>
<br>
</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%201-1.png" class="img-fluid figure-img" style="width:150.0%"></p>
<figcaption class="figure-caption">% Off of Course Record by Age, Race, and Gender</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
Next, we examined what ages were actually winning the marathons. We found the best performance for each race and year for each sex, and found that the most female winners were 28, and most male winners were 29 (Figure 2). The mean age of the female winners was 30.31, and the mean age of male winners was 28.99. </p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%202-1.png" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">Histogram of Ages of Marathon Winners by Gender</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
I also visualized how average marathon times improved over time over the years, faceted by gender. As we can see from Figure 3, on average, both men and women have been improving over time since 1993. Women saw a quick increase in pace in the 1990s, and then plateaued from 2000-2008, but gradually improved from 2008-2016. Men have been steadily getting faster, aside from a plateau between 2000 and 2007.<br>
<br>
</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%203-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Marathon Time in Minutes by Year</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
To determine if a red flag results in a weaker average performance in each age group, we plotted the mean percent off course record for each of the binned age groups (Young, Middle, Older, and Senior; previously described in <em>Methods</em>), for each flag for each race (Figure 4). Error bars represent 95% confidence intervals based on standard error. The only races that showed differences in performance based on flag were the Boston, Chicago, and Twin Cities marathons. In the Boston Marathon, the mean percent off course record increases between the white and red flags for all age groups except for “Young”, and this increase appears to be largest in the “Senior” group. For the Twin Cities marathon, mean percent off course record also increases for all age groups except “Young” between the white flag and red flag. For the Chicago marathon, mean percent off course record increases between the white and red flags for the “Middle” and “Older” groups only. However, there were few (16) results recorded in the “Senior” age group with a red flag, so the lack of significance may be due to the small sample size.<br>
<br>
The difference in performance by age group may not necessarily be due to physiological effects caused by the weather. For example, runners could be aware that the flag was red and purposefully slowed down for their own well being and comfort, rather than being physically unable to go any faster. Older runners may believe that they are more susceptible to health problems from running in the heat than younger runners, so they choose to just run the race at a slower than usual pace.<br>
<br>
</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%204-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Mean % off Course Record by Age and Flag</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>To see how the weather variables are correlated with each other, we produced a plot of the correlations between the variables. Percent off of course record appears to only be strongly correlated with age. The weather variables are correlated with each other, which is to be expected since many of the variables are calculated based on other variables. Humidity and solar radiation are negatively correlated, and wind and aqi are negatively correlated.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%205-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Correlations of Weather Variables with % off Course Record</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>We thought that stratifying the results by sex and age group might result in higher correlations of percent off of course record with the weather variables. In this correlation plot, we can see that the weather variables are not strongly correlated with percent off of course record for any of the groups. The performance of senior men is not correlated with any weather variables, but it is highly correlated with age (correlation = .80). Potentially, the effect of age is strong enough that it obscures the impact of any of the weather variables on percent off of course record. Senior women’s performance is also not correlated with any weather variables, other than a weak (.12) correlation with AQI. Older men and women’s performances are weakly correlated with dry bulb, wet bulb, black globe, dew point, WBGT, and AQI. Correlation does not seem to vary across gender within this age group. The runners in the middle age group’s performances are also weakly correlated with the previously mentioned weather variables, except for AQI, although to a lesser extent than the “older” age group. These correlations also do not seem to vary across genders. We did not include the “Young” age group, since they had few observations and we suspected that they would not differ strongly from the “Middle” age group. Overall, WBGT seems to be the most correlated with a decreased performance across the age groups. </p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Project_1_files/figure-html/Fig%206-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Correlations of Weather Variables with % off Course Record by Age Group and Gender</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>Finally, to further investigate the effects of age, sex, and WBGT on marathon performance, we performed a linear regression. We modeled percent off of course record based on the three way interaction of age, sex, and WBGT. The results of this regression are shown in Table 2. The interaction of age and WBGT is significant (p &lt; .05), but the three way interaction is not, and neither is sex with WBGT. This agrees with the results from our previous correlation plots.</p>
<p>We also performed a second linear regression, this time using all the weather variables, age, year, race, and interactions between age with dry bulb temperature, relative humidity, solar radiation, and air quality index. We found that age, year, race, relative humidity, solar radiation, air quality, the interaction of age with relative humidity, age with solar radiation, and age with air quality were significant.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Results of Linear Regression of % Off of Course Record ~ Interaction between Age:Sex:WBGT</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-42.058</td>
<td style="text-align: right;">3.139</td>
<td style="text-align: right;">-13.400</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">1.880</td>
<td style="text-align: right;">0.065</td>
<td style="text-align: right;">28.888</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex</td>
<td style="text-align: right;">-13.043</td>
<td style="text-align: right;">4.250</td>
<td style="text-align: right;">-3.069</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="even">
<td style="text-align: left;">WBGT</td>
<td style="text-align: right;">1.118</td>
<td style="text-align: right;">0.222</td>
<td style="text-align: right;">5.042</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age:Sex</td>
<td style="text-align: right;">0.182</td>
<td style="text-align: right;">0.085</td>
<td style="text-align: right;">2.130</td>
<td style="text-align: right;">0.033</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age:WBGT</td>
<td style="text-align: right;">-0.014</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">-3.067</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex:WBGT</td>
<td style="text-align: right;">0.242</td>
<td style="text-align: right;">0.300</td>
<td style="text-align: right;">0.806</td>
<td style="text-align: right;">0.420</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age:Sex:WBGT</td>
<td style="text-align: right;">-0.006</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">-0.910</td>
<td style="text-align: right;">0.363</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="discussion-and-conclusion" class="level1">
<h1>Discussion and Conclusion</h1>
<p>This analysis shows that aging clearly impacts marathon performance, as shown in previous studies, and that this effect differs across gender. We initially hypothesized that aging would impact performance, but not necessarily across gender.</p>
<p>Furthermore, we show that the effects of weather conditions on marathon performance differ by age, when age is binned and when age is continuous. The results from Figure 4 demonstrate how the impact of the warning flag differs across age groups, with runners older than 65 being the most likely to experience a decline in performance in “red” conditions. Some weather conditions were shown to be important in predicting performance declines. These variables were relative humidity, solar radiation, and air quality. Since WGBT factors into these conditions, WGBT seems to be a good overall measure of weather conditions. However, since air quality is shown to be associated with marathon performance, it might be worthwhile to investigate how it could be factored into this the WGBT measurement, or how it should be included in further statistical analyses.</p>
<p>A limitation of this study is that the effects of the weather on marathon performance may not be entirely physiological, and that runners are aware of the weather conditions due to reading weather reports or seeing the flag conditions. Therefore, they might not be running at their fullest effort in order to protect their health and comfort. However, since this data contains only the top performers of each age, it is unlikely that the runners would be purposefully slowing themselves down. Another limitation is that the air quality index data is not as specific as it could be. Further research could map which exact air quality testing sites are nearest to the race course, rather than just using the closest cbsa code as we did in this study. Also, since this study is only looking at the top performers in each age group, it isn’t necessarily applicable to slower or less experienced runners. Future research could focus on middle of the pack runners in each age group. Finally, since this is just an exploratory data analysis, more rigorous statistical analysis should be done to make any strong conclusions on the effects of weather on marathon runners.</p>
<p>In conclusion, aging is associated with decreased marathon performance in runners, and this effect varies across gender. Furthermore, weather conditions, specifically relative humidity, solar radiation, and aqi, affect marathon performance, and age interacts with all of these variables. The effects of weather on performance do not seem to differ by gender.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Ely, M. R., Cheuvront, S. N., Roberts, W. O., &amp; Montain, S. J. (2007). Impact of weather on Marathon-running performance. Medicine &amp; Science in Sports &amp; Exercise, 39(3), 487–493. https://doi.org/10.1249/mss.0b013e31802d3aba</p>
<p>Kenney, W. L., &amp; Munce, T. A. (2003). Invited review: Aging and human temperature regulation. Journal of Applied Physiology, 95(6), 2598–2603. https://doi.org/10.1152/japplphysiol.00202.2003</p>
<p>Knechtle, B., McGrath, C., Goncerz, O., Villiger, E., Nikolaidis, P. T., Marcin, T., &amp; Sousa, C. V. (2021). The role of environmental conditions on Master marathon running performance in 1,280,557 finishers the ‘new york city marathon’ from 1970 to 2019. Frontiers in Physiology, 12. https://doi.org/10.3389/fphys.2021.665761</p>
<p>Mccrowey C, Sharac T, Mangus N, Jager D, Brown R, Garver D, Wells B, Brittingham H (2023). _A R Interface to the US EPA Air Quality System Data Mart API_. &lt;https://cran.r-project.org/package=RAQSAPI&gt;.</p>
<p>Reusser, M., Sousa, C. V., Villiger, E., Alvero Cruz, J. R., Hill, L., Rosemann, T., Nikolaidis, P. T., &amp; Knechtle, B. (2021). Increased Participation and Decreased Performance in Recreational Master Athletes in “Berlin Marathon” 1974-2019. Frontiers in physiology, 12, 631237. https://doi.org/10.3389/fphys.2021.631237</p>
<p>NOAA (National Oceanic and Atmospheric Administration). (2024). Heat stress datasets and documentation (provided to EPA by NOAA in April 2024) [Data set].</p>
</section>
<section id="code-appendix" class="level1">
<h1>Code Appendix</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo=</span><span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#packages used for this rmd document, not including the RAQSAPI package used to </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve data for air quality</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#load in the data that we use throughout the report</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/rachelyost/Downloads/project1.csv"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>course_record <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/rachelyost/Downloads/course_record (2).csv"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>aqi_values <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/rachelyost/Downloads/aqi_values.csv"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#data preprocessing</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#make column names easier to use within the code</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Race"</span>, <span class="st">"Year"</span>, <span class="st">"Sex"</span>, <span class="st">"Flag"</span>, <span class="st">"Age"</span>, <span class="st">"CR"</span>, <span class="st">"TdC"</span>, <span class="st">"TwC"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"rh"</span>, <span class="st">"TgC"</span>, <span class="st">"SRWm2"</span>, <span class="st">"DP"</span>, <span class="st">"Wind"</span>, <span class="st">"WBGT"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure columns are of the correct type</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#check data types</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#make variables are factors if they should be factors</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Race <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Race)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>Year)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>Sex)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Flag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>Flag)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#Change names of races to actual names rather than numbers and change sex </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#to Male/Female</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Race =</span> <span class="fu">case_when</span>(Race <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Boston"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                                 Race <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                                 Race <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                                 Race <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Twin Cities"</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                                 Race <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Grandma's"</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Sex =</span> <span class="fu">ifelse</span>(Sex <span class="sc">==</span> <span class="st">"0"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span>))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Change course record data to match main data so it can be easily joined</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>course_record <span class="ot">&lt;-</span> course_record <span class="sc">%&gt;%</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Race =</span> <span class="fu">case_when</span>(Race<span class="sc">==</span><span class="st">"B"</span> <span class="sc">~</span> <span class="st">"Boston"</span> ,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                          Race <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                          Race <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                          Race <span class="sc">==</span> <span class="st">"TC"</span> <span class="sc">~</span> <span class="st">"Twin Cities"</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                          Race <span class="sc">==</span> <span class="st">"D"</span> <span class="sc">~</span> <span class="st">"Grandma's"</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Gender =</span> <span class="fu">ifelse</span>(Gender <span class="sc">==</span> <span class="st">"M"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sex =</span> Gender)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">#make year a factor to join with main data set</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>course_record<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">factor</span>(course_record<span class="sc">$</span>Year)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">#join data with course record data and change course record to be in minutes</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(course_record, data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Race"</span>, <span class="st">"Year"</span>, <span class="st">"Sex"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CR.y =</span> <span class="fu">hms</span>(CR.y))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>CR.y <span class="ot">=</span> <span class="fu">hour</span>(data<span class="sc">$</span>CR.y)<span class="sc">*</span><span class="dv">60</span> <span class="sc">+</span> <span class="fu">minute</span>(data<span class="sc">$</span>CR.y) <span class="sc">+</span> <span class="fu">second</span>(data<span class="sc">$</span>CR.y)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">#create a new variable Time, that shows the actual time for each participant</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Time <span class="ot">=</span> ((data<span class="sc">$</span>CR.x<span class="sc">/</span><span class="dv">100</span>)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>(data<span class="sc">$</span>CR.y)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co">#filter aqi_values to only include results with sample duration = 24 HOUR</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>aqi_dat <span class="ot">&lt;-</span> aqi_values <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_duration <span class="sc">==</span> <span class="st">"24 HOUR"</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicates</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>include <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(aqi_dat)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>aqi_dat <span class="ot">&lt;-</span> aqi_dat[include,]</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">#change format of year so that it matches the main data</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>aqi_dat<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(aqi_dat<span class="sc">$</span>date_local, <span class="at">format=</span><span class="st">"%Y/%m/%d"</span>),<span class="st">"%Y"</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co">#get mean aqi by cbsa_code and year and marathon</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>aqi_dat <span class="ot">&lt;-</span> aqi_dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cbsa_code, Year, marathon) <span class="sc">%&gt;%</span> </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">aqi=</span> <span class="fu">mean</span>(aqi))</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="co">#remove cbsa code</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>aqi_dat <span class="ot">&lt;-</span> aqi_dat[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co">#change column names for easy joining</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(aqi_dat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Year"</span>,<span class="st">"Race"</span>,<span class="st">"aqi"</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>aqi_dat <span class="ot">&lt;-</span> aqi_dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Race =</span> <span class="fu">case_when</span>(Race <span class="sc">==</span> <span class="st">"Boston"</span> <span class="sc">~</span> <span class="st">"Boston"</span>,</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>                                    Race <span class="sc">==</span> <span class="st">"Chicago"</span> <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                                    Race <span class="sc">==</span> <span class="st">"NYC"</span> <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>                                    Race <span class="sc">==</span> <span class="st">"Twin Cities"</span> <span class="sc">~</span><span class="st">"Twin Cities"</span>,</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>                                    Race <span class="sc">==</span> <span class="st">"Grandmas"</span> <span class="sc">~</span> <span class="st">"Grandma's"</span>,</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                                  ))</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co">#merge the data</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>data_w_aqi <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, aqi_dat)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co">#remove this empty entry</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>data_w_aqi <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(Race <span class="sc">==</span> <span class="st">"New York"</span> <span class="sc">&amp;</span> Year <span class="sc">==</span> <span class="st">"2012"</span>))</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="co">#create bins for age groups</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>data_w_aqi <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Age_binned =</span> <span class="fu">case_when</span>(Age <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">"Young"</span>,</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>                                       Age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Middle"</span>,</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>                                       Age <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"Older"</span>,</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>                                       Age <span class="sc">&lt;</span> <span class="dv">99</span> <span class="sc">~</span> <span class="st">"Senior"</span>))</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co">#order the flags and age binds correctly</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>data_w_aqi<span class="sc">$</span>Flag <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_w_aqi<span class="sc">$</span>Flag, <span class="at">levels =</span> </span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Green"</span>, <span class="st">"Yellow"</span>, <span class="st">"Red"</span>, <span class="st">"Black"</span>))</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>data_w_aqi<span class="sc">$</span>Age_binned <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_w_aqi<span class="sc">$</span>Age_binned, <span class="at">levels =</span> </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Middle"</span>, <span class="st">"Older"</span>, <span class="st">"Senior"</span>))</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co">#make Cr.x just CR</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_w_aqi)[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">"CR"</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="co">#examine missingness in the main data</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_w_aqi))</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="co">#see which columns are missing data and how much</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(data_w_aqi))</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co">#shows percent of data missing for each race and year to see if missingness </span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="co">#is race-specific</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>summary_of_missing <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Race, Year) <span class="sc">%&gt;%</span> </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.x))<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">n</span>(), <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>summary_of_missing</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="co">#the data for the weather columns other than aqi is missing for race 1 in 2011, </span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="co">#race 2 in 2011, race 3 in 2011, and race 4 in 2012</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="do">####get a histogram of the distribution of the values of each column</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data_w_aqi)){</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(data_w_aqi[[i]])){</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(data_w_aqi[[i]], <span class="at">main =</span> <span class="fu">colnames</span>(data_w_aqi)[i]) </span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{}</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">na.omit</span>(data<span class="sc">$</span>rh <span class="sc">&lt;</span> <span class="dv">1</span>))<span class="sc">/</span><span class="fu">nrow</span>(<span class="fu">na.omit</span>(data))</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">na.omit</span>(data[data<span class="sc">$</span>rh <span class="sc">&gt;</span> <span class="dv">1</span>,<span class="st">"rh"</span>]))</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a><span class="co">#get humidity for each race</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>humidities <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Year, Race) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_humidity =</span> <span class="fu">mean</span>(rh))</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a><span class="co">#if humidity was recorded as a decimal, change to a percent</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>rh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>rh <span class="sc">&lt;=</span> <span class="dv">1</span>, data<span class="sc">$</span>rh<span class="sc">*</span><span class="dv">100</span>, data<span class="sc">$</span>rh)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a><span class="co">#remove variables that I don't want in table</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>data_for_summary_table <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">"Year"</span>, <span class="sc">-</span><span class="st">"CR.y"</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="co">#rename variables for the table</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_for_summary_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Race"</span>, <span class="st">"Sex"</span>, <span class="st">"Flag"</span>, <span class="st">"Age"</span>,<span class="st">"% Course Record"</span>,</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Dry Bulb"</span> ,<span class="st">"Wet Bulb"</span>, <span class="st">"% Relative Humidity"</span>  </span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>                                      ,<span class="st">"Black Globe"</span>, <span class="st">"Solar Radiation"</span> ,<span class="st">"Dew Point"</span>,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Wind"</span>,  <span class="st">"WBGT"</span>, <span class="st">"Time"</span>, <span class="st">"AQI"</span>, <span class="st">"Age Binned"</span>)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>data_for_summary_table_races <span class="ot">&lt;-</span> data_for_summary_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(Race, Flag, <span class="st">"Dry Bulb"</span>, <span class="st">"Wet Bulb"</span>, <span class="st">"% Relative Humidity"</span> ,<span class="st">"Black Globe"</span>, <span class="st">"Solar Radiation"</span> ,<span class="st">"Dew Point"</span>, <span class="st">"Wind"</span>,  <span class="st">"WBGT"</span>, <span class="st">"AQI"</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="co">#don't include missing counts in table</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_summary</span>(data_for_summary_table_races, <span class="at">by =</span> Race, <span class="at">missing =</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as_kable_extra</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>                  <span class="at">caption =</span> <span class="st">"Race Characteristics"</span>,</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longtable =</span> <span class="cn">TRUE</span>, <span class="at">linesep =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, </span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>                 <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"repeat_header"</span>, <span class="st">"HOLD_position"</span>))</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>data_for_summary_table_people <span class="ot">&lt;-</span> data_for_summary_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"Race"</span>, <span class="st">"Sex"</span>, <span class="st">"Age"</span>,<span class="st">"% Course Record"</span> ,<span class="st">"Time"</span>, <span class="st">"Age Binned"</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="co">#don't include missing counts in table</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_summary</span>(data_for_summary_table_people, <span class="at">by=</span>Race, <span class="at">missing =</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as_kable_extra</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>                  <span class="at">caption =</span> <span class="st">"Participant Characteristics"</span>,</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longtable =</span> <span class="cn">TRUE</span>, <span class="at">linesep =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>, </span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>                 <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"repeat_header"</span>, <span class="st">"HOLD_position"</span>))</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>data_w_aqi <span class="ot">&lt;-</span> data_w_aqi <span class="co">#rmd wont write captions for 2 figures in a row</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a><span class="co">#plot % off CR by age faceted by gender</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_w_aqi, <span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> CR)) <span class="sc">+</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span> </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> Sex), <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Race) <span class="sc">+</span> </span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"% off Course Record"</span>, <span class="at">color =</span> <span class="st">"Sex"</span>, <span class="at">linetype =</span> <span class="st">"Sex"</span>) <span class="sc">+</span> </span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"sans"</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">90</span>, <span class="dv">10</span>))</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a><span class="do">##for race, find the lowest %CR</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>winners <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Race,Year,Sex) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CR <span class="sc">==</span> <span class="fu">min</span>(CR))</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a><span class="co">#winners %&gt;% group_by(Sex) %&gt;% summarize(mean_age = mean(Age))</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(winners) <span class="sc">+</span> </span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">fill =</span> Sex), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span> </span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sex) <span class="sc">+</span> </span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"sans"</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),  </span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),  </span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span> </span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(winners<span class="sc">$</span>Age), <span class="fu">max</span>(winners<span class="sc">$</span>Age), <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a><span class="do">###look at how the fastest time for each age decreased by year</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>data_4_plot <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sex,Year) <span class="sc">%&gt;%</span> </span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time))</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a><span class="co">#plot marathon time in minutes by year</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_4_plot, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Year)), <span class="at">y=</span> Time)) <span class="sc">+</span> </span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Mean Race Time in Minutes"</span>) <span class="sc">+</span> </span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sex) <span class="sc">+</span> </span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> </span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">seq</span>(<span class="dv">1993</span>, <span class="dv">2016</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">180</span>, <span class="dv">235</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a><span class="do">###look at average times in each group for each flag</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>flag_age <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Age_binned, Flag, Race) <span class="sc">%&gt;%</span> </span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">percent_CR =</span> <span class="fu">mean</span>(CR), <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">se =</span> <span class="fu">sd</span>(CR)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>flag_age <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(flag_age)</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>p_boston <span class="ot">&lt;-</span> (<span class="fu">ggplot</span>(flag_age[flag_age<span class="sc">$</span>Race <span class="sc">==</span> <span class="st">"Boston"</span>,], </span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x=</span>Flag, <span class="at">y =</span> percent_CR, <span class="at">fill=</span>Flag)) <span class="sc">+</span> </span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_col</span>(<span class="at">color=</span><span class="st">"Black"</span>)  <span class="sc">+</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>(percent_CR <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se), </span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ymax =</span> (percent_CR <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se)), <span class="at">width =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>              <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean % off  CR"</span>, <span class="at">title =</span> <span class="st">"Boston"</span>) <span class="sc">+</span> </span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Green"</span>, <span class="st">"Yellow"</span>, <span class="st">"Red"</span>))  <span class="sc">+</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>              <span class="fu">facet_wrap</span>(<span class="sc">~</span>Age_binned)) <span class="sc">+</span> </span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">30</span>))</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>p_chicago <span class="ot">&lt;-</span> (<span class="fu">ggplot</span>(flag_age[flag_age<span class="sc">$</span>Race <span class="sc">==</span> <span class="st">"Chicago"</span>,], </span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>Flag, <span class="at">y =</span> percent_CR, <span class="at">fill=</span>Flag)) <span class="sc">+</span> </span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_col</span>(<span class="at">color=</span><span class="st">"black"</span>)  <span class="sc">+</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>(percent_CR <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se), </span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ymax =</span> (percent_CR <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se)), <span class="at">width =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>              <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean % off  CR"</span>, <span class="at">title =</span> <span class="st">"Chicago"</span>) <span class="sc">+</span> </span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Green"</span>, <span class="st">"Yellow"</span>, <span class="st">"Red"</span>)) <span class="sc">+</span> </span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>              <span class="fu">facet_wrap</span>(<span class="sc">~</span>Age_binned)) <span class="sc">+</span> </span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">30</span>))</span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>p_twin_cities <span class="ot">&lt;-</span> (<span class="fu">ggplot</span>(flag_age[flag_age<span class="sc">$</span>Race <span class="sc">==</span> <span class="st">"Twin Cities"</span>,], </span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x=</span>Flag, <span class="at">y =</span> percent_CR, <span class="at">fill=</span>Flag)) <span class="sc">+</span> </span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_col</span>(<span class="at">color=</span><span class="st">"Black"</span>)  <span class="sc">+</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>(percent_CR <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se), </span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ymax =</span> (percent_CR <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se)), </span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>                        <span class="at">width =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean % off CR"</span>, <span class="at">title =</span> <span class="st">"Twin Cities"</span>) <span class="sc">+</span> </span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Green"</span>, </span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">"Yellow"</span>, <span class="st">"Red"</span>))  <span class="sc">+</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Age_binned)) <span class="sc">+</span> </span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">30</span>))</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(p_boston, p_chicago, p_twin_cities)</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a><span class="co">#make year an integer for correlations</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>data_w_aqi<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(data_w_aqi<span class="sc">$</span>Year))</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a><span class="co">#make sex numeric</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>data_w_aqi<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_w_aqi<span class="sc">$</span>Sex <span class="sc">==</span> <span class="st">"Female"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a><span class="do">#### get correlations between %CR and each of the weather variables</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a><span class="co">#remove variables we aren't interest in</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>cor_data <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Age_binned, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y,</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>                                         <span class="sc">-</span>Sex)</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data))</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Year"</span> ,<span class="st">"Age"</span> ,  <span class="st">"% Course Record"</span> , <span class="st">"Dry Bulb"</span>,</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Wet Bulb"</span>  , <span class="st">"% Relative Humidity"</span> ,<span class="st">"Black Globe"</span>,</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Solar Radiation"</span> ,<span class="st">"Dew Point"</span> ,   <span class="st">"Wind"</span>,  <span class="st">"WBGT"</span> ,<span class="st">"AQI"</span>)</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Year"</span>,<span class="st">"Age"</span> ,  <span class="st">"% Course Record"</span> , <span class="st">"Dry Bulb"</span>,</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Wet Bulb"</span>  , <span class="st">"% Relative Humidity"</span> ,<span class="st">"Black Globe"</span>,</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Solar Radiation"</span> ,<span class="st">"Dew Point"</span> ,   <span class="st">"Wind"</span>,  <span class="st">"WBGT"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a><span class="co">#plot results with corrplot</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">'color'</span>, <span class="at">addCoef.col =</span> <span class="st">'black'</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>, </span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="dv">1</span>, <span class="at">tl.cex =</span> <span class="dv">1</span>)</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a><span class="do">###compare senior men, senior women, with middle men, middle women</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a><span class="co">#make corr plots for each group</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>cor_data_senior_men <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Senior"</span>, Sex<span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>cor_data_senior_women <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Senior"</span>, Sex<span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>cor_data_older_men <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Older"</span>, Sex<span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>cor_data_older_women <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Older"</span>, Sex<span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>cor_data_middle_men <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Middle"</span>, Sex<span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>cor_data_middle_women <span class="ot">&lt;-</span> data_w_aqi <span class="sc">%&gt;%</span> </span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Race, <span class="sc">-</span>Flag, <span class="sc">-</span>Time, <span class="sc">-</span>CR.y) <span class="sc">%&gt;%</span> </span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_binned <span class="sc">==</span> <span class="st">"Middle"</span>, Sex<span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">select</span>(<span class="sc">-</span>Age_binned, <span class="sc">-</span>Sex)</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>cor_matrix_sm <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_senior_men))</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>cor_matrix_sw <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_senior_women))</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>cor_matrix_mm <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_middle_men))</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>cor_matrix_mw <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_middle_women))</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>cor_matrix_om <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_older_men))</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>cor_matrix_ow <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">na.omit</span>(cor_data_older_women))</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a><span class="co">#create matrix</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>cor_matrix2 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(cor_matrix_sm[,<span class="st">"CR"</span>],cor_matrix_om[,<span class="st">"CR"</span>],</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>                                   cor_matrix_mm[,<span class="st">"CR"</span>],cor_matrix_sw[,<span class="st">"CR"</span>],</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>                                   cor_matrix_ow[,<span class="st">"CR"</span>],cor_matrix_mw[,<span class="st">"CR"</span>]))</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a><span class="co">#change row and column names</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"%CR Senior Men"</span>, <span class="st">"%CR Older Men"</span>, <span class="st">"%CR Middle Men"</span>, </span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"%CR Senior Women"</span>, <span class="st">"%CR Older Women"</span>, <span class="st">"%CR Middle Women"</span>)</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Year"</span>,<span class="st">"Age"</span> ,<span class="st">"% Course Record"</span> , <span class="st">"Dry Bulb"</span> ,</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Wet Bulb"</span>  , <span class="st">"% Relative Humidity"</span> ,  <span class="st">"Black Globe"</span>,</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Solar Radiation"</span> ,<span class="st">"Dew Point"</span> ,   <span class="st">"Wind"</span>,<span class="st">"WBGT"</span>,<span class="st">"AQI"</span>)</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a><span class="co">#plot results with corrplot</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix2, <span class="at">method =</span> <span class="st">'color'</span>, <span class="at">addCoef.col =</span> <span class="st">'black'</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>, </span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="dv">1</span>, <span class="at">tl.cex =</span> <span class="dv">1</span>) </span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(CR <span class="sc">~</span> Age<span class="sc">*</span>Sex<span class="sc">*</span>WBGT, <span class="at">data=</span>data_w_aqi))</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(summary[[<span class="st">"coefficients"</span>]], <span class="at">caption =</span> <span class="st">"Results of Linear Regression </span></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a><span class="st">      of % Off of Course Record ~ Interaction between Age:Sex:WBGT"</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>summary2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(CR <span class="sc">~</span> Age <span class="sc">+</span> Year <span class="sc">+</span> Race <span class="sc">+</span> Sex <span class="sc">+</span> TdC <span class="sc">+</span> TwC <span class="sc">+</span> rh <span class="sc">+</span> TgC <span class="sc">+</span></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>                         SRWm2 <span class="sc">+</span> DP <span class="sc">+</span> aqi <span class="sc">+</span> Age<span class="sc">*</span>TdC <span class="sc">+</span> Age<span class="sc">*</span>TdC <span class="sc">+</span> Age<span class="sc">*</span>rh <span class="sc">+</span> </span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>                         Age<span class="sc">*</span>SRWm2 <span class="sc">+</span> Age<span class="sc">*</span>aqi, <span class="at">data=</span>data_w_aqi))</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(summary2[[<span class="st">"coefficients"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>